#test_with_1Kb_data_file
#
#RHASH - Test executable
#TEST_DATA_FILE - test1K.data
#TMPDIR - temporary directory for test
#
#new_test "test with 1Kb data file:    "
#TEST_RESULT=$( $rhash --printf "%f %C %M %H %E %G %T %A %W\n" test1K.data 2>/dev/null )
#TEST_EXPECTED="test1K.data B70B4C26 B2EA9F7FCEA831A4A63B213F41A8855B 5B00669C480D5CFFBDFA8BDBA99561160F2D1B77 5AE257C47E9BE1243EE32AABE408FB6B 890BB3EE5DBE4DA22D6719A14EFD9109B220607E1086C1ABBB51EEAC2B044CBB 4OQY25UN2XHIDQPV5U6BXAZ47INUCYGIBK7LFNI LMAGNHCIBVOP7PP2RPN2TFLBCYHS2G3X D606B7F44BD288759F8869D880D9D4A2F159D739005E72D00F93B814E8C04E657F40C838E4D6F9030A8C9E0308A4E3B450246250243B2F09E09FA5A24761E26B"
#check "$TEST_RESULT" "$TEST_EXPECTED" .
# test reversed GOST hashes and verification of them
#TEST_RESULT=$( $rhash --simple --gost --gost-cryptopro --gost-reverse test1K.data )
#TEST_EXPECTED="test1K.data  bb4c042bacee51bbabc186107e6020b20991fd4ea119672da24dbe5deeb30b89  06cc52d9a7fb5137d01667d1641683620060391722a56222bb4b14ab332ec9d9"
#check "$TEST_RESULT" "$TEST_EXPECTED" .
#TEST_RESULT=$( $rhash --simple --gost --gost-cryptopro --gost-reverse test1K.data | $rhash -vc - 2>/dev/null | grep test1K.data )
#match "$TEST_RESULT" "^test1K.data *OK"
include(CMakeTestMacros.cmake)
set(TEST_EXPECTED "test1K.data B70B4C26 B2EA9F7FCEA831A4A63B213F41A8855B 5B00669C480D5CFFBDFA8BDBA99561160F2D1B77 5AE257C47E9BE1243EE32AABE408FB6B 890BB3EE5DBE4DA22D6719A14EFD9109B220607E1086C1ABBB51EEAC2B044CBB 4OQY25UN2XHIDQPV5U6BXAZ47INUCYGIBK7LFNI LMAGNHCIBVOP7PP2RPN2TFLBCYHS2G3X D606B7F44BD288759F8869D880D9D4A2F159D739005E72D00F93B814E8C04E657F40C838E4D6F9030A8C9E0308A4E3B450246250243B2F09E09FA5A24761E26B\n")

#\n
execute_process(
COMMAND ${RHASH} --printf "%f %C %M %H %E %G %T %A %W\n" "${TEST_DATA_FILE}"
   OUTPUT_VARIABLE TEST_RESULT RESULT_VARIABLE TEST_ERR_VAR)
checkrun()
check_test_res_equality()
# test reversed GOST hashes and verification of them
set(TEST_EXPECTED "${TEST_DATA_FILE}  bb4c042bacee51bbabc186107e6020b20991fd4ea119672da24dbe5deeb30b89  06cc52d9a7fb5137d01667d1641683620060391722a56222bb4b14ab332ec9d9\n")
SET(TEST_STR "test_string1")
SET(TEST_FILE "test.results")
execute_process(COMMAND ${RHASH} --simple --gost --gost-cryptopro --gost-reverse "${TEST_DATA_FILE}"
   OUTPUT_VARIABLE TEST_RESULT RESULT_VARIABLE TEST_ERR_VAR ERROR_VARIABLE TEST_ERROR_RESULT)
checkrun()
check_test_res_equality()

#rhash -vc
FILE(WRITE "${TMPDIR}/${TEST_FILE}" "${TEST_RESULT}")
execute_process(COMMAND ${RHASH} -vc "${TMPDIR}/${TEST_FILE}"
   OUTPUT_VARIABLE TEST_RESULT RESULT_VARIABLE TEST_ERR_VAR)
checkrun()
string(REGEX MATCH "test1K.data *OK" _POS_OK ${TEST_RESULT})
check_POS_OK()
FILE(REMOVE "${TMPDIR}/${TEST_FILE}")
