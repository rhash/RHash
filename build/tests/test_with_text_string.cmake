#test_with_text_string.cmake
#
#Parameters:
#
#  RHASH = rhash executable
#  TDATA = test data file test1K.data
#
#do something like this:
#
#====
#new_test "test with text string:      "
#TEST_STR="test_string1"
#TEST_RESULT=$( printf "$TEST_STR" | $rhash -CHMETAGW --sfv - | tail -1 )
#TEST_EXPECTED="(stdin) F0099E81 B78F440152DBAD00E77017074DC15417 EA8511AE2CA899D68DB423AD751B446C6F958507 R37TT7VDWGK26FUDTFANGUJBFKYDGAV4ARK3EEI 9EDCAE6F50EFE09F0837DA66A8B88C13 5KCRDLRMVCM5NDNUEOWXKG2ENRXZLBIH 01D00FBBA6A0903499385151BF678CDF4294986CF5B76A6A5660AC5834FA429E12861BC5174C7648CA4086B0FCE3F211F80423824E9A9589A20FC43A81D8B752 3D3E1DB92A2030B1287769AAD2190DD69EED5911644EC6E7BB7AEAB5FC701BE3"
#check "$TEST_RESULT" "$TEST_EXPECTED"
#
#===

message("RHASH - ${RHASH}")
message("TDATA - ${TDATA}")

set(EXPECTED_RES "(test.file) F0099E81 B78F440152DBAD00E77017074DC15417 EA8511AE2CA899D68DB423AD751B446C6F958507 R37TT7VDWGK26FUDTFANGUJBFKYDGAV4ARK3EEI 9EDCAE6F50EFE09F0837DA66A8B88C13 5KCRDLRMVCM5NDNUEOWXKG2ENRXZLBIH 01D00FBBA6A0903499385151BF678CDF4294986CF5B76A6A5660AC5834FA429E12861BC5174C7648CA4086B0FCE3F211F80423824E9A9589A20FC43A81D8B752 3D3E1DB92A2030B1287769AAD2190DD69EED5911644EC6E7BB7AEAB5FC701BE3")
file(WRITE test.file "test_string1")
execute_process(COMMAND ${RHASH} -CHMETAGW --sfv test.file
  RESULT_VARIABLE RES_VAR
  OUTPUT_VARIABLE STD_OUT
  ERROR_VARIABLE ERR_OUT) 
if ((NOT "${RES_VAR}" STREQUAL "0") AND (NOT "${RES_VAR}" STREQUAL ""))
  message("Result code: ${RES_VAR}")
  message(FATAL_ERROR "stdout: ${STD_OUT}\rstderr: ${ERR_OUT}")
endif((NOT "${RES_VAR}" STREQUAL "0") AND (NOT "${RES_VAR}" STREQUAL ""))

file(REMOVE test.file)

string(FIND ${EXPECTED_RES} ${RES_VAR} _LOC)

if (NOT _LOC STRGREATER -1)
  message(FATAL_ERROR "FAILED ${RES_VAR} ${EXPECTED_RES}")
endif()


