#test_all_hash_options.cmake
#
#RHASH - Test executable
#TEST_DATA_FILE - test1K.data
#TMPDIR - temporary directory for test
#
#HASHOPT="`$rhash --list-hashes|sed 's/ .*$//;/[^3]-/s/-\([0-9R]\)/\1/'|tr A-Z a-z`"
#
#if [ -n "$OPT_FULL" ]; then
#  new_test "test all hash options:      "
#  errors=0
#  for opt in $HASHOPT ; do
#    TEST_RESULT=$( printf "a" | $rhash --$opt --simple - )
#    match "$TEST_RESULT" "\b[0-9a-z]\{8,128\}\b" . || errors=$((errors+1))
#  done
#  check $errors 0
#fi

set(TEST_EXPECTED "test.string F0099E81 B78F440152DBAD00E77017074DC15417 EA8511AE2CA899D68DB423AD751B446C6F958507 R37TT7VDWGK26FUDTFANGUJBFKYDGAV4ARK3EEI 9EDCAE6F50EFE09F0837DA66A8B88C13 5KCRDLRMVCM5NDNUEOWXKG2ENRXZLBIH 01D00FBBA6A0903499385151BF678CDF4294986CF5B76A6A5660AC5834FA429E12861BC5174C7648CA4086B0FCE3F211F80423824E9A9589A20FC43A81D8B752 3D3E1DB92A2030B1287769AAD2190DD69EED5911644EC6E7BB7AEAB5FC701BE3")
include(CMakeTestMacros.cmake)
SET(TEST_STR "a")
SET(TEST_FILE "a")

execute_process(
   COMMAND ${RHASH}  --list-hashes OUTPUT_VARIABLE TEST_RESULT RESULT_VARIABLE TEST_ERR_VAR ERROR_VARIABLE TEST_ERROR_RESULT)
checkrun()
FILE(WRITE "${TMPDIR}/${TEST_FILE}" "${TEST_STR}")
string(TOLOWER TEST_RESULT "TEST_RESULT")

string(REPLACE "\n" ";" HASHOPTS "${TEST_RESULT}")
string(REPLACE "-" "" HASHOPTS "${HASHOPTS}")

foreach OPT ${HASHOPTS})
execute_process(
   COMMAND ${RHASH}  --${_OPT} --simple "${TMPDIR}/${TEST_FILE}"
   OUTPUT_VARIABLE TEST_RESULT RESULT_VARIABLE TEST_ERR_VAR ERROR_VARIABLE TEST_ERROR_RESULT
)
checkrun()
string(REGEX MATCH "\b[0-9a-z]\{8,128\}\b" _POS_OK ${TEST_RESULT})
check_POS_OK()
endeach(OPT)

FILE(REMOVE "${TMPDIR}/${TEST_FILE}")

